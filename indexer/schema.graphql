# ============ POOL REGISTRY ============

type Pool @entity {
  id: ID! # Pool ID (bytes32)
  currency0: String! # Token 0 address
  currency1: String! # Token 1 address
  fee: Int! # Fee tier
  tickSpacing: Int! # Tick spacing
  hooks: String! # Hooks contract address
  
  # Current state
  liquidity: BigInt!
  sqrtPriceX96: BigInt!
  tick: Int!
  
  # Cumulative stats
  volumeToken0: BigDecimal!
  volumeToken1: BigDecimal!
  txCount: BigInt!
  
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
}

# ============ PROTOCOL STATISTICS ============

type ProtocolStats @entity {
  id: ID! # "uniswap-v4"
  name: String!
  
  # Pool metrics
  poolCount: Int!
  
  # Volume (we'll track major tokens)
  volumeTotalETH: BigDecimal!
  volume24hETH: BigDecimal!
  volumeTotalUSDC: BigDecimal!
  volume24hUSDC: BigDecimal!
  
  # Activity
  totalTransactions: BigInt!
  transactions24h: BigInt!
  totalSwaps: BigInt!
  swaps24h: BigInt!
  totalLiquidityModifications: BigInt!
  
  # Users
  uniqueUsers: BigInt!
  uniqueUsers24h: BigInt!
  
  # Performance
  avgGasPrice: BigInt!
  tps: Float!
  
  lastUpdateTime: BigInt!
  lastBlockNumber: BigInt!
}

# ============ TRANSACTIONS ============

type Transaction @entity {
  id: ID! # txHash-logIndex
  txType: String! # "swap" | "add_liquidity" | "remove_liquidity"
  pool: Pool! # Relation to pool
  poolId: String! # Pool ID for filtering
  
  sender: String!
  
  # Token amounts (can be positive or negative)
  amount0: BigDecimal!
  amount1: BigDecimal!
  
  # Token addresses for easy filtering
  token0: String!
  token1: String!
  
  # Swap-specific data
  sqrtPriceX96: BigInt
  liquidity: BigInt
  tick: Int
  
  # Liquidity-specific data
  tickLower: Int
  tickUpper: Int
  liquidityDelta: BigDecimal
  
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: String!
  logIndex: Int!
  gasPrice: BigInt!
}

# ============ WHALE TRACKING ============

type WhaleActivity @entity {
  id: ID! # wallet address
  wallet: String!
  
  # Activity by token
  volumeETH: BigDecimal!
  volumeUSDC: BigDecimal!
  volumeWBTC: BigDecimal!
  
  transactionCount: Int!
  swapCount: Int!
  liquidityModCount: Int!
  
  # Pool diversity
  poolsUsed: [String!]! # Array of pool IDs
  poolCount: Int!
  
  largestSwapETH: BigDecimal!
  largestSwapUSDC: BigDecimal!
  
  firstSeenTime: BigInt!
  lastActiveTime: BigInt!
}

# ============ CAPITAL FLOWS (CROSS-POOL) ============

type CapitalFlow @entity {
  id: ID! # flowId
  wallet: String!
  
  fromPoolId: String!
  toPoolId: String!
  
  # Token being moved
  tokenAddress: String!
  tokenSymbol: String!
  amount: BigDecimal!
  
  timestamp: BigInt!
  timeDelta: Int! # Seconds between remove and add liquidity
  flowType: String! # "rebalancing" | "fast_move"
  
  withdrawTxHash: String!
  depositTxHash: String!
}

# ============ HOURLY SNAPSHOTS ============

type HourlySnapshot @entity {
  id: ID! # "uniswap-v4-{timestamp}"
  timestamp: BigInt!
  
  # Protocol-wide metrics
  totalVolumeETH: BigDecimal!
  totalVolumeUSDC: BigDecimal!
  transactions: Int!
  swaps: Int!
  uniqueUsers: Int!
  poolCount: Int!
  
  avgGasPrice: BigInt!
}

# ============ POOL HOURLY SNAPSHOTS ============

type PoolHourlySnapshot @entity {
  id: ID! # "poolId-{timestamp}"
  pool: Pool!
  poolId: String!
  timestamp: BigInt!
  
  # Pool state at this hour
  liquidity: BigInt!
  sqrtPriceX96: BigInt!
  tick: Int!
  
  # Volume this hour
  volumeToken0: BigDecimal!
  volumeToken1: BigDecimal!
  txCount: Int!
  
  # User activity
  uniqueUsers: Int!
}

# ============ TOKEN REGISTRY ============

type Token @entity {
  id: ID! # token address
  symbol: String!
  name: String!
  decimals: Int!
  
  # Usage metrics
  poolCount: Int!
  totalVolume: BigDecimal!
}

# ============ AAVE V3 SPECIFIC ENTITIES ============

type AaveReserve @entity {
  id: ID! # reserve token address
  symbol: String!
  name: String!
  decimals: Int!
  
  # Total amounts
  totalSupplied: BigDecimal!
  totalBorrowed: BigDecimal!
  
  # Rates (in Ray units: 1e27)
  liquidityRate: BigInt! # Deposit APY
  stableBorrowRate: BigInt!
  variableBorrowRate: BigInt! # Borrow APY
  
  # Indexes
  liquidityIndex: BigInt!
  variableBorrowIndex: BigInt!
  
  # Utilization
  utilizationRate: Float! # totalBorrowed / totalSupplied
  
  # Activity
  supplyCount: BigInt!
  borrowCount: BigInt!
  liquidationCount: BigInt!
  
  lastUpdateTimestamp: BigInt!
  lastUpdateBlockNumber: BigInt!
}

type AaveProtocolStats @entity {
  id: ID! # "aave-v3"
  name: String!
  
  # TVL in major assets
  totalSuppliedETH: BigDecimal!
  totalSuppliedUSDC: BigDecimal!
  totalSuppliedDAI: BigDecimal!
  totalSuppliedWBTC: BigDecimal!
  
  # Borrowed amounts
  totalBorrowedETH: BigDecimal!
  totalBorrowedUSDC: BigDecimal!
  totalBorrowedDAI: BigDecimal!
  totalBorrowedWBTC: BigDecimal!
  
  # Global utilization
  globalUtilizationRate: Float!
  
  # Activity counts
  totalSupplies: BigInt!
  supplies24h: BigInt!
  totalWithdrawals: BigInt!
  withdrawals24h: BigInt!
  totalBorrows: BigInt!
  borrows24h: BigInt!
  totalRepays: BigInt!
  repays24h: BigInt!
  totalLiquidations: BigInt!
  liquidations24h: BigInt!
  
  # Users
  uniqueSuppliers: BigInt!
  uniqueBorrowers: BigInt!
  uniqueUsers24h: BigInt!
  
  # Performance
  avgGasPrice: BigInt!
  tps: Float!
  
  # Health
  healthScore: Int! # 0-100 based on utilization, liquidations, etc.
  
  lastUpdateTime: BigInt!
  lastBlockNumber: BigInt!
}

type AaveTransaction @entity {
  id: ID! # txHash-logIndex
  txType: String! # "supply" | "withdraw" | "borrow" | "repay" | "liquidation"
  
  # User
  user: String!
  onBehalfOf: String # For supply/borrow
  
  # Asset
  reserve: String! # Token address
  reserveSymbol: String!
  amount: BigDecimal!
  
  # Liquidation specific
  collateralAsset: String
  debtAsset: String
  liquidator: String
  debtToCover: BigDecimal
  liquidatedCollateralAmount: BigDecimal
  
  # Borrow specific
  interestRateMode: Int # 1 = stable, 2 = variable
  borrowRate: BigInt
  
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: String!
  logIndex: Int!
  gasPrice: BigInt!
}

type AaveUserPosition @entity {
  id: ID! # user-reserve
  user: String!
  reserve: String!
  reserveSymbol: String!
  
  # Balances
  suppliedAmount: BigDecimal!
  borrowedAmount: BigDecimal!
  
  # Activity
  supplyCount: Int!
  withdrawCount: Int!
  borrowCount: Int!
  repayCount: Int!
  
  firstSupplyTime: BigInt
  lastActivityTime: BigInt!
}

# ============ CROSS-PROTOCOL ENTITIES ============

type CrossProtocolFlow @entity {
  id: ID! # flow-id
  wallet: String!
  
  # From (can be Uniswap or Aave)
  fromProtocol: String! # "uniswap-v4" | "aave-v3"
  fromPoolOrReserve: String!
  
  # To (can be Uniswap or Aave)
  toProtocol: String! # "uniswap-v4" | "aave-v3"
  toPoolOrReserve: String!
  
  # Asset moved
  tokenAddress: String!
  tokenSymbol: String!
  amount: BigDecimal!
  
  timestamp: BigInt!
  timeDelta: Int! # Seconds between transactions
  flowType: String! # "liquidity_rebalancing" | "yield_farming" | "arbitrage"
  
  fromTxHash: String!
  toTxHash: String!
}

# ============ ENHANCED WHALE ACTIVITY (Multi-Protocol) ============

type MultiProtocolWhale @entity {
  id: ID! # wallet address
  wallet: String!
  
  # Uniswap V4 activity
  uniswapVolumeETH: BigDecimal!
  uniswapVolumeUSDC: BigDecimal!
  uniswapSwapCount: Int!
  
  # Aave V3 activity
  aaveSuppliedETH: BigDecimal!
  aaveSuppliedUSDC: BigDecimal!
  aaveBorrowedETH: BigDecimal!
  aaveBorrowedUSDC: BigDecimal!
  aaveSupplyCount: Int!
  aaveBorrowCount: Int!
  
  # Cross-protocol
  protocolsUsed: [String!]! # ["uniswap-v4", "aave-v3"]
  crossProtocolFlows: Int!
  
  # Overall
  totalTransactionCount: Int!
  largestTransactionETH: BigDecimal!
  
  firstSeenTime: BigInt!
  lastActiveTime: BigInt!
}

# ============ PROTOCOL HEALTH (Multi-Protocol) ============

type ProtocolHealthSnapshot @entity {
  id: ID! # protocol-timestamp
  protocol: String! # "uniswap-v4" | "aave-v3"
  timestamp: BigInt!
  
  healthScore: Int! # 0-100
  
  # Indicators (protocol-specific)
  utilizationRate: Float
  tvlChangePercent24h: Float
  whaleExits1h: Int!
  gasSpike: Float!
  liquidationCount1h: Int! # Aave specific
  
  warnings: String! # JSON array
}

# ============ HOURLY SNAPSHOTS (Multi-Protocol) ============

type AaveHourlySnapshot @entity {
  id: ID! # "aave-v3-{timestamp}"
  timestamp: BigInt!
  
  # Supplied
  totalSuppliedETH: BigDecimal!
  totalSuppliedUSDC: BigDecimal!
  
  # Borrowed
  totalBorrowedETH: BigDecimal!
  totalBorrowedUSDC: BigDecimal!
  
  # Utilization
  globalUtilizationRate: Float!
  
  # Activity
  supplies: Int!
  withdrawals: Int!
  borrows: Int!
  repays: Int!
  liquidations: Int!
  
  uniqueUsers: Int!
  healthScore: Int!
}