# yaml-language-server: $schema=./node_modules/envio/evm.schema.json
name: envio-indexer
unordered_multichain_mode: true
preload_handlers: true

contracts:
  - name: PoolManager
    handler: src/EventHandlers.ts
    events:
    - event: Initialize(bytes32 indexed id, address indexed currency0, address indexed currency1, uint24 fee, int24 tickSpacing, address hooks, uint160 sqrtPriceX96, int24 tick)
      field_selection:
        transaction_fields:
          - "hash"
          - "gasPrice"
    - event: ModifyLiquidity(bytes32 indexed id, address indexed sender, int24 tickLower, int24 tickUpper, int256 liquidityDelta, bytes32 salt)
      field_selection:
        transaction_fields:
          - "hash"
          - "gasPrice"
    - event: Swap(bytes32 indexed id, address indexed sender, int128 amount0, int128 amount1, uint160 sqrtPriceX96, uint128 liquidity, int24 tick, uint24 fee)
      field_selection:
        transaction_fields:
          - "hash"
          - "gasPrice"
  
  - name: AaveV3Pool
    handler: src/EventHandlers.ts
    events:
    - event: Supply(address indexed reserve, address user, address indexed onBehalfOf, uint256 amount, uint16 indexed referralCode)
    - event: Withdraw(address indexed reserve, address indexed user, address indexed to, uint256 amount)
    - event: Borrow(address indexed reserve, address user, address indexed onBehalfOf, uint256 amount, uint8 interestRateMode, uint256 borrowRate, uint16 indexed referralCode)
    - event: Repay(address indexed reserve, address indexed user, address indexed repayer, uint256 amount, bool useATokens)
    - event: LiquidationCall(address indexed collateralAsset, address indexed debtAsset, address indexed user, uint256 debtToCover, uint256 liquidatedCollateralAmount, address liquidator, bool receiveAToken)
    - event: ReserveDataUpdated(address indexed reserve, uint256 liquidityRate, uint256 stableBorrowRate, uint256 variableBorrowRate, uint256 liquidityIndex, uint256 variableBorrowIndex)

  - name: Lido
    handler: src/EventHandlers.ts
    events:
      - event: Submitted(address indexed sender, uint256 amount, address referral)
      - event: Transfer(address indexed from, address indexed to, uint256 value)
      - event: TransferShares(address indexed from, address indexed to, uint256 sharesValue)
  
  # Curve 3pool (USDC/USDT/DAI) - highest volume stableswap
  - name: Curve3Pool
    handler: src/EventHandlers.ts
    events:
      - event: TokenExchange(address indexed buyer, int128 sold_id, uint256 tokens_sold, int128 bought_id, uint256 tokens_bought)
      - event: AddLiquidity(address indexed provider, uint256[3] token_amounts, uint256[3] fees, uint256 invariant, uint256 token_supply)
      - event: RemoveLiquidity(address indexed provider, uint256[3] token_amounts, uint256[3] fees, uint256 token_supply)
      - event: RemoveLiquidityOne(address indexed provider, uint256 token_amount, uint256 coin_amount)
  
  # Curve stETH/ETH pool
  - name: CurveStETHPool
    handler: src/EventHandlers.ts
    events:
      - event: TokenExchange(address indexed buyer, int128 sold_id, uint256 tokens_sold, int128 bought_id, uint256 tokens_bought)
      - event: AddLiquidity(address indexed provider, uint256[2] token_amounts, uint256[2] fees, uint256 invariant, uint256 token_supply)
      - event: RemoveLiquidity(address indexed provider, uint256[2] token_amounts, uint256[2] fees, uint256 token_supply)
      - event: RemoveLiquidityOne(address indexed provider, uint256 token_amount, uint256 coin_amount)
  
  # Curve Tricrypto (USDT/WBTC/ETH)
  - name: CurveTricryptoPool
    handler: src/EventHandlers.ts
    events:
      - event: TokenExchange(address indexed buyer, uint256 sold_id, uint256 tokens_sold, uint256 bought_id, uint256 tokens_bought)
      - event: AddLiquidity(address indexed provider, uint256[3] token_amounts, uint256 token_supply)
      - event: RemoveLiquidity(address indexed provider, uint256[3] token_amounts, uint256 token_supply)

  # CDP Manager (Vault operations)
  - name: MakerCDPManager
    handler: src/EventHandlers.ts
    events:
      - event: NewCdp(address indexed usr, address indexed own, uint256 indexed cdp)
  
  # Vat (Core CDP engine) - LogNote is anonymous, limiting indexed params
  - name: MakerVat
    handler: src/EventHandlers.ts
    events:
      - event: LogNote(bytes4 indexed sig, address indexed usr, bytes32 indexed arg1, bytes32 arg2, bytes data)
  
  # Cat (Liquidations - before MakerDAO upgrade)
  - name: MakerCat
    handler: src/EventHandlers.ts
    events:
      - event: Bite(bytes32 indexed ilk, address indexed urn, uint256 ink, uint256 art, uint256 tab, address flip, uint256 id)
  
  # Dog (Liquidations 2.0 - after upgrade)
  - name: MakerDog
    handler: src/EventHandlers.ts
    events:
      - event: Bark(bytes32 indexed ilk, address indexed urn, uint256 ink, uint256 art, uint256 due, address clip, uint256 id)

networks:
  - id: 1
    start_block: 11473216 # Lido deployment (earliest of all protocols)
    contracts:
      - name: PoolManager
        address:
          - '0x000000000004444c5dc75cB358380D2e3dE08A90'
      - name: AaveV3Pool
        address:
          - '0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2'
      - name: Lido
        address:
          - '0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84'
      - name: Curve3Pool
        address:
          - '0xbEbc44782C7dB0a1A60Cb6fe97d0b483032FF1C7'
      - name: CurveStETHPool
        address:
          - '0xDC24316b9AE028F1497c275EB9192a3Ea0f67022'
      - name: CurveTricryptoPool
        address:
          - '0xD51a44d3FaE010294C616388b506AcdA1bfAAE46'
      - name: MakerCDPManager
        address:
          - '0x5ef30b9986345249bc32d8928B7ee64DE9435E39'
      - name: MakerVat
        address:
          - '0x35D1b3F3D7966A1DFe207aa4514C12a259A0492B'
      - name: MakerCat
        address:
          - '0xa5679C04fc3d9d8b0AaB1F0ab83555b301cA70Ea'
      - name: MakerDog
        address:
          - '0x135954d155898D42C90D2a57824C690e0c7BEf1B'
